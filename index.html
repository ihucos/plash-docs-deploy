<html>
<head>
<meta charset="utf-8"/>
<title>Plash documentation</title>
<link rel="stylesheet" type="text/css" href="assets/style.css"/>
</head>
<body>
<section>
<a href="https://github.com/ihucos/plash"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>

<pre style="padding-top: 32px; color: #2F5485;">

        ########  ##          ###     ######  ##     ## 
        ##     ## ##         ## ##   ##    ## ##     ## 
        ##     ## ##        ##   ##  ##       ##     ## 
        ########  ##       ##     ##  ######  ######### 
        ##        ##       #########       ## ##     ## 
        ##        ##       ##     ## ##    ## ##     ## 
        ##        ######## ##     ##  ######  ##     ##
          
              Bloatless Containerization Software
</pre>

<h2>Intro</h2>
<p>
Plash is a small program to build and run containers in Linux. Essentially
plash provides a handy interface to create chrooted proccesses without being
root. It has its own image build instructions and container runtime. Plash is
written in C using minimal dependencies that should allow it to compile and
work for decades without any further changes.
</p>

<h2>Install</h2>
<pre>
cd $(mktemp -d)
git clone git@github.com:ihucos/plash.git .
make
sudo cp dist/plash /usr/local/bin

# uninstall
sudo rm /usr/local/bin/plash
</pre>


<h2>Help</h2>
<p>
TODO: move stuff from github to here.
</p>

<h2>Commands</h2>
</pre>
<table>

<div style="min-width: 8em; display: inline-block;">
      <a href="--help.html">--help</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="--help-macros.html">--help-macros</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="--version.html">--version</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="-h.html">-h</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="add-layer.html">add-layer</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="b.html">b</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="build.html">build</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="clean.html">clean</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="copy.html">copy</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="create.html">create</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="data.html">data</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="eval.html">eval</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="export-tar.html">export-tar</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="help.html">help</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="help-macros.html">help-macros</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="import-docker.html">import-docker</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="import-lxc.html">import-lxc</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="import-tar.html">import-tar</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="import-url.html">import-url</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="init.html">init</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="map.html">map</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="mkdtemp.html">mkdtemp</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="mount.html">mount</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="nodepath.html">nodepath</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="parent.html">parent</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="purge.html">purge</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="rm.html">rm</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="run.html">run</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="runb.html">runb</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="shrink.html">shrink</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="sudo.html">sudo</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="test.html">test</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="version.html">version</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="with-mount.html">with-mount</a>
</div>

<div style="min-width: 8em; display: inline-block;">
      <a href="-*.html">-*</a>
</div>

</table>
<h2>Build Instructions</h2>

<table>

<tr>
  <td>
    usage:
  </td>
  <td>
    Plash eval ...
  </td>
</tr>

<tr>
  <td>
    --hint
  </td>
  <td>
    Write a hint for consumer programs
  </td>
</tr>

<tr>
  <td>
    --entrypoint
  </td>
  <td>
    Hint default command for this build
  </td>
</tr>

<tr>
  <td>
    --entrypoint-script
  </td>
  <td>
    Write lines to /entrypoint and hint it as default command
  </td>
</tr>

<tr>
  <td>
    --env
  </td>
  <td>
    Use env from host when running image
  </td>
</tr>

<tr>
  <td>
    --env-prefix
  </td>
  <td>
    Use all envs with given prefix when running image
  </td>
</tr>

<tr>
  <td>
    --eval-file
  </td>
  <td>
    Evaluate file content as expressions
  </td>
</tr>

<tr>
  <td>
    --eval-github
  </td>
  <td>
    Eval a file (default &#39;plashfile&#39;) from a github repo
  </td>
</tr>

<tr>
  <td>
    --eval-stdin
  </td>
  <td>
    Evaluate expressions read from stdin
  </td>
</tr>

<tr>
  <td>
    --hash-path
  </td>
  <td>
    Recursively hash files and add as cache key
  </td>
</tr>

<tr>
  <td>
    --import-env
  </td>
  <td>
    Import environment variables from host while building
  </td>
</tr>

<tr>
  <td>
    --invalidate-layer
  </td>
  <td>
    Invalidate the cache of the current layer
  </td>
</tr>

<tr>
  <td>
    --layer
  </td>
  <td>
    Hints the start of a new layer
  </td>
</tr>

<tr>
  <td>
    --mount
  </td>
  <td>
    Mount filesystem when running image (&#34;src:dst&#34; supported)
  </td>
</tr>

<tr>
  <td>
    --run
  </td>
  <td>
    Directly emit shell script
  </td>
</tr>

<tr>
  <td>
    --run-stdin
  </td>
  <td>
    Run commands read from stdin
  </td>
</tr>

<tr>
  <td>
    --write-file
  </td>
  <td>
    Write lines to a file
  </td>
</tr>

<tr>
  <td>
    --write-script
  </td>
  <td>
    Write an executable (755) file to the filesystem
  </td>
</tr>

<tr>
  <td>
    --from
  </td>
  <td>
    Guess from where to take the image
  </td>
</tr>

<tr>
  <td>
    --from-docker
  </td>
  <td>
    Use image from local docker
  </td>
</tr>

<tr>
  <td>
    --from-github
  </td>
  <td>
    Build and use a file (default &#39;plashfile&#39;) from a github repo
  </td>
</tr>

<tr>
  <td>
    --from-id
  </td>
  <td>
    Specify the image from an image id
  </td>
</tr>

<tr>
  <td>
    --from-lxc
  </td>
  <td>
    Use images from images.linuxcontainers.org
  </td>
</tr>

<tr>
  <td>
    --from-map
  </td>
  <td>
    Use resolved map as image
  </td>
</tr>

<tr>
  <td>
    --from-url
  </td>
  <td>
    Import image from an url
  </td>
</tr>

<tr>
  <td>
    --apk
  </td>
  <td>
    Install packages with apk
  </td>
</tr>

<tr>
  <td>
    --apt
  </td>
  <td>
    Install packages with apt
  </td>
</tr>

<tr>
  <td>
    --defpm
  </td>
  <td>
    Define a new package manager
  </td>
</tr>

<tr>
  <td>
    --dnf
  </td>
  <td>
    Install packages with dnf
  </td>
</tr>

<tr>
  <td>
    --emerge
  </td>
  <td>
    Install packages with emerge
  </td>
</tr>

<tr>
  <td>
    --npm
  </td>
  <td>
    Install packages with npm
  </td>
</tr>

<tr>
  <td>
    --pacman
  </td>
  <td>
    Install packages with pacman
  </td>
</tr>

<tr>
  <td>
    --pip
  </td>
  <td>
    Install packages with pip
  </td>
</tr>

<tr>
  <td>
    --pip3
  </td>
  <td>
    Install packages with pip3
  </td>
</tr>

<tr>
  <td>
    --yum
  </td>
  <td>
    Install packages with yum
  </td>
</tr>

<tr>
  <td>
    --A
  </td>
  <td>
    Alias for: --from alpine:edge --apk [arg1 [arg2 [...]]]
  </td>
</tr>

<tr>
  <td>
    --C
  </td>
  <td>
    Alias for: --from centos:8 --yum [arg1 [arg2 [...]]]
  </td>
</tr>

<tr>
  <td>
    --D
  </td>
  <td>
    Alias for: --from debian:sid --apt [arg1 [arg2 [...]]]
  </td>
</tr>

<tr>
  <td>
    --F
  </td>
  <td>
    Alias for: --from fedora:32 --dnf [arg1 [arg2 [...]]]
  </td>
</tr>

<tr>
  <td>
    --G
  </td>
  <td>
    Alias for: --from gentoo:current --emerge [arg1 [arg2 [...]]]
  </td>
</tr>

<tr>
  <td>
    --R
  </td>
  <td>
    Alias for: --from archlinux:current --pacman [arg1 [arg2 [...]]]
  </td>
</tr>

<tr>
  <td>
    --U
  </td>
  <td>
    Alias for: --from ubuntu:focal --apt [arg1 [arg2 [...]]]
  </td>
</tr>

<tr>
  <td>
    --f
  </td>
  <td>
    Alias for: --from [arg1 [arg2 [...]]]
  </td>
</tr>

<tr>
  <td>
    --l
  </td>
  <td>
    Alias for: --layer [arg1 [arg2 [...]]]
  </td>
</tr>

<tr>
  <td>
    --x
  </td>
  <td>
    Alias for: --run [arg1 [arg2 [...]]]
  </td>
</tr>

</table>

<h2>Command Dependencies</h2>
<a href="graph.svg"><img src="graph.svg"></img></a>

<h2>Breadcrumbs</h2>
<h3>Image editing with gimp</h3>
<pre>$ plash build --from alpine --apk ttf-ubuntu-font-family gimp --layer --run 'touch /myfile'
112
$ plash run 112 gimp</pre>

<h3>Run python scripts</h3>
<pre>plash --from-github ihucos/python -- python myscript.py</pre>

<h3>Integration with docker</h3>
<pre>plash export-tar --from alpine | docker import -
plash --from-docker busybox
</pre>

<h3>Manage your dotfiles</h3>
<pre>plash -A py3-pip --layer --pip3 dotfiles -- dotfiles --sync</pre>

<h3>User namespaces</h3>
<pre>$ whoami
myuser
$ plash sudo whoami
root</pre>

<h3>Fetch a  container image</h3>
<pre>$ plash build --from alpine
plash: fetching 100%
plash: extracting...
plash: ignoring dev file: ./dev/null (Operation not permitted)
2</pre>

<h3>Run something in a container</h3>
<pre>$ plash run 2 printf 'hello from container\n'
hello from container</pre>

<h3>Automatic filesystem mapping</h3>
<pre>$ mkdir ~/mydir
$ cd ~/mydir
$ plash run 2 pwd
/home/myuser/mydir</pre>

<h3>Add layer to existing container</h3>
<pre>$ plash build --from 2 --run 'touch /myfile'
+ touch /myfile
--:
3</pre>

<h3>Build and run in one command</h3>
<pre>$ plash b run --from alpine --run 'touch /myfile' -- ls /myfile
/myfile</pre>

<h3>Shorter invocation</h3>
<pre>$ plash -Ax 'touch /myfile' -- ls /myfile
/myfile</pre>

<h3>Explicit layering</h3>
<pre>$ plash -Ax 'touch /myfile' -lx 'touch /otherfile' -- ls /otherfile </pre>

<h3>Access container root filesystem</h3>
<pre>$ plash b with-mount -A -- ls
bin  dev  etc  home  lib  media  mnt  proc  root  run  sbin  srv  sys  tmp  usr  var</pre>

<h3>Remove last layer of an image</h3>
<pre>$ plash b rm --from-github ihucos/python</pre>

<h3>Create an executable build file</h3>
<pre>$ cat /tmp/yapf
#!/usr/bin/env plash
--from-github ihucos/python
--pip3 yapf
--entrypoint /usr/bin/yapf
$ /tmp/yapf myproject</pre>

<h3>Example of a more complex executable build file</h3>
<pre>#!/usr/bin/env plash
--from archlinux
--pacman gtk3 python-gobject
--layer
--entrypoint-script 
#!/usr/bin/env python
import gi
gi.require_version('Gtk', '3.0')
from gi.repository import Gtk
Gtk.init(None)
Hello = Gtk.MessageDialog(message_type=Gtk.MessageType.INFO,
                          buttons=Gtk.ButtonsType.OK,
                          text="Hello world!",
                          secondary_text="This is running inside a plash container.")
Hello.run()</pre>

<h3>Macros expand to shell code</h3>
<pre>$ plash eval --from ubuntu --apt python3-pip --layer --pip3 yapf -lx 'touch /foo'
### plash hint: image=9
apt-get update
apt-get install -y python3-pip
### plash hint: layer
pip3 install yapf
### plash hint: layer
touch /foo</pre>

<i>Last updated: 2023-01-31</i>
</section>
</body>
</html>